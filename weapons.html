<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legendary Weapons - Squad Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Philosopher:wght@400;700&display=swap');
        
        body {
            font-family: 'Philosopher', sans-serif;
            background: linear-gradient(to bottom, #0a0e27, #1a1a2e, #16213e);
            color: #e0e0e0;
        }
        
        h1, h2, h3, .cinzel {
            font-family: 'Cinzel', serif;
        }
        
        .glow-text {
            text-shadow: 0 0 20px rgba(100, 181, 246, 0.8), 0 0 40px rgba(100, 181, 246, 0.4);
        }
        
        .gold-text {
            color: #d4af37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        
        .budget-display {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #d4af37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .weapon-card {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #334155;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .weapon-card:hover {
            border-color: #d4af37;
            box-shadow: 0 8px 35px rgba(212, 175, 55, 0.3);
            transform: translateY(-5px);
        }
        
        .weapon-card.selected {
            border-color: #10b981;
            box-shadow: 0 8px 35px rgba(16, 185, 129, 0.4);
        }
        
        .weapon-card.selected .weapon-portrait {
            border-color: #10b981;
        }
        
        .weapon-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .weapon-portrait {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #334155, #475569);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            border-bottom: 3px solid #475569;
            position: relative;
            overflow: hidden;
        }
        
        .weapon-portrait-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(1px);
            opacity: 0.6;
            transition: all 0.3s ease;
            z-index: 0;
        }
        
        .weapon-card:hover .weapon-portrait-bg {
            filter: blur(0px);
            opacity: 0.8;
            transform: scale(1.05);
        }
        
        .weapon-card.selected .weapon-portrait-bg {
            filter: blur(0px);
            opacity: 0.9;
        }
        
        .weapon-portrait::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, 
                rgba(15, 23, 42, 0.3) 0%, 
                rgba(15, 23, 42, 0.5) 50%,
                rgba(15, 23, 42, 0.9) 100%);
            z-index: 1;
        }
        
        .weapon-card.selected .weapon-portrait::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(16, 185, 129, 0.15);
            z-index: 2;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.15; }
            50% { opacity: 0.25; }
        }
        
        .weapon-portrait > span {
            position: relative;
            z-index: 3;
        }
        
        .weapon-info {
            padding: 1.25rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            box-shadow: 0 0 20px rgba(100, 181, 246, 0.6);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-back {
            background: linear-gradient(135deg, #475569, #64748b);
            transition: all 0.3s ease;
        }
        
        .btn-back:hover {
            background: linear-gradient(135deg, #64748b, #94a3b8);
        }
        
        .quote-text {
            font-style: italic;
            color: #94a3b8;
            font-size: 0.85rem;
            border-left: 3px solid #475569;
            padding-left: 0.75rem;
            margin: 0.75rem 0;
        }

        .budget-display {
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    border: 1px solid rgba(212, 175, 55, 0.6);
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
    transition: all 0.3s ease;
}

.budget-display:hover {
    border-color: rgba(212, 175, 55, 0.9);
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
}
    </style>
</head>
<body class="min-h-screen">
    <!-- Header with Budget -->
    <header class="fixed top-0 left-0 right-0 z-50 bg-black bg-opacity-90 backdrop-blur-sm border-b border-blue-900">
    <div class="container mx-auto px-4 md:px-6 py-3">
        <div class="flex justify-between items-center">
            <div class="flex-1">
                <h1 class="text-base md:text-xl font-bold cinzel glow-text">The Long Night</h1>
                <p class="text-xs text-gray-400 hidden md:block">Weapons Selection</p>
            </div>
            <div class="flex items-center gap-3 md:gap-6">
                <div class="text-right">
                    <p class="text-sm md:text-base font-bold text-blue-300 cinzel"><span id="weapon-count">0</span>/2</p>
                </div>
                <div class="budget-display px-3 md:px-4 py-2 rounded-lg flex items-center gap-2 border border-opacity-70">
                    <span class="text-lg md:text-xl">üí∞</span>
                    <p class="text-sm md:text-base font-bold gold-text cinzel"><span id="budget">100</span></p>
                </div>
            </div>
        </div>
    </div>
</header>

    <div class="container mx-auto px-6 pt-24">
        <!-- Weapons View -->
        <div id="weapons-view" class="mt-12 md:mt-8">
            <h2 class="text-3xl md:text-4xl font-bold cinzel text-center mb-3 glow-text">Legendary Weapons</h2>
            <p class="text-center text-gray-300 mb-12 text-sm md:text-base">Arm yourself with artifacts forged to fight the darkness</p>
            
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="weapons-container">
                <!-- Weapons will be generated by JS -->
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="mt-16 mb-12 flex justify-center">
            <button onclick="goToSquad()" class="btn-back px-8 py-3 rounded-lg font-bold cinzel text-sm md:text-base">
                ‚Üê Back to Squad
            </button>
        </div>
    </div>

    <script>

        const CURRENT_VERSION = '2.0';

function checkAndClearOldData() {
    const savedVersion = localStorage.getItem('gameVersion');
    if (savedVersion !== CURRENT_VERSION) {
        localStorage.clear();
        localStorage.setItem('gameVersion', CURRENT_VERSION);
    }
}

checkAndClearOldData();
        // Default game state
        const DEFAULT_STATE = {
            budget: 100,
            maxBudget: 100,
            squad: {
                characters: [],
                magicalBeings: [],
                weapons: []
            },
            houseCounts: {},
            beingTypes: [],
            currentView: 'weapons'
        };

        // Initialize game state from localStorage
        let gameState = loadGameState();

        // Load game state with validation
        function loadGameState() {
            try {
                const saved = localStorage.getItem('asoiafGameState');
                if (!saved) return {...DEFAULT_STATE};
                
                const parsed = JSON.parse(saved);
                
                if (typeof parsed.budget !== 'number' || 
                    !Array.isArray(parsed.squad?.weapons)) {
                    return {...DEFAULT_STATE};
                }
                
                return parsed;
            } catch (error) {
                console.error('Error loading game state:', error);
                return {...DEFAULT_STATE};
            }
        }

        // Save game state
        function saveGameState() {
            try {
                localStorage.setItem('asoiafGameState', JSON.stringify(gameState));
            } catch (error) {
                console.error('Error saving game state:', error);
            }
        }

        // Weapons Database
        const weapons = [
            { id: "weap15", name: "Wildfire", price: 15, score: 18, description: "Highly volatile substance brewed by alchemists, ignites on contact", image: "https://i.pinimg.com/1200x/c2/11/68/c211687b72acaa4f9efc90b7cec72dde.jpg" },
            { id: "weap13", name: "Blackfyre", price: 15, score: 15, description: "Valyrian steel sword of Aegon the Conqueror", image: "./fyre.jpg" },
            { id: "weap8", name: "Dawn", price: 15, score: 18, description: "Forged from the heart of a fallen star, borne by the Sword of the Morning", image: "./dawn.jpg" },
            { id: "weap2", name: "Ice", price: 15, score: 15, description: "House Stark's greatsword, Valyrian steel of unmatched quality", image: "https://awoiaf.westeros.org/images/1/18/Ice_Sarah_Biddle_II.png" },
           
           
            { id: "weap14", name: "Crossbow", price: 12, score: 10, description: "Powerful ranged weapon, capable of piercing armor with precision and force", image: "https://i.pinimg.com/736x/f0/17/49/f01749e1ecd42368cc81ae9836c03abc.jpg" },
            { id: "weap9", name: "War Hammer", price: 12, score: 12, description: "Heavy iron weapon capable of crushing armor and bone", image: "./hammer.jpg" },
           
            { id: "weap6", name: "Lady Forlorn", price: 12, score: 10, description: "Valyrian steel sword of House Corbray", image: "./forlon.jpg" },
            { id: "weap16", name: "Darksister", price: 12, score: 12, description: "Valyrian steel sword of Visenya Targaryen", image: "./sister.jpg" },
            { id: "weap1", name: "Longclaw", price: 12, score: 14, description: "Jon Snow's Valyrian steel bastard sword, ancestral blade of House Mormont", image: "./longclaw.jpg" },
            { id: "weap5", name: "Heartsbane", price: 12, score: 12, description: "House Tarly's Valyrian steel greatsword", image: "heartsbane.jpg" },
            { id: "weap11", name: "Red Rain", price: 12, score: 10, description: "Valyrian steel sword of House Drumm", image: "https://awoiaf.westeros.org/images/thumb/2/2c/TommyArnold_Red_Rain.png/350px-TommyArnold_Red_Rain.png" },
            { id: "weap12", name: "Nightfall", price: 12, score: 10, description: "Valyrian steel sword of House Harlaw", image: "https://awoiaf.westeros.org/images/thumb/7/76/Nightfall.jpg/350px-Nightfall.jpg" },
            { id: "weap3", name: "Oathkeeper", price: 10, score: 10, description: "Reforged from Ice, given to Brienne of Tarth", image: "https://external-preview.redd.it/ADw8LQcXry2VulxzTDXRhL_jtuuUiAzzkdssYpdxddQ.jpg?auto=webp&s=f6f7151c4e99b6240a9f7f49b64d8ef235574fb8" },
            { id: "weap4", name: "Widow's Wail", price: 10, score: 8, description: "Reforged from Ice, wielded by King Joffrey", image: "https://awoiaf.westeros.org/images/thumb/6/68/Joshua_CairosJoff_Widows_Wail.jpg/350px-Joshua_CairosJoff_Widows_Wail.jpg" },
           
        ];
 
        // Initialize weapons view
        function initWeaponsView() {
            const container = document.getElementById('weapons-container');
            container.innerHTML = '';
            
            weapons.forEach(weapon => {
                const card = createWeaponCard(weapon);
                container.appendChild(card);
            });
        }

        // Create weapon card
        function createWeaponCard(weapon) {
            const card = document.createElement('div');
            const isSelected = gameState.squad.weapons.find(w => w.id === weapon.id);
            const canAfford = gameState.budget >= weapon.price;
            const canSelect = gameState.squad.weapons.length < 2 && canAfford;
            
            card.className = `weapon-card rounded-xl ${isSelected ? 'selected' : ''} ${!canSelect && !isSelected ? 'disabled' : ''}`;
            card.innerHTML = `
                <div class="weapon-portrait">
                    ${weapon.image 
                        ? `<div class="weapon-portrait-bg" style="background-image: url('${weapon.image}');"></div>` 
                        : `<span>‚öîÔ∏è</span>`}
                </div>
                <div class="weapon-info">
                    <h4 class="text-lg font-bold cinzel text-center mb-2">${weapon.name}</h4>
                    <p class="quote-text">"${weapon.description}"</p>
                    <div class="mt-auto">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-gray-400 text-xs">Price:</span>
                            <span class="text-xl font-bold gold-text">${weapon.price} üí∞</span>
                        </div>
                        ${isSelected ? 
                            `<button onclick="removeWeapon('${weapon.id}')" class="w-full px-3 py-2 text-xs md:text-sm bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-lg font-bold transition-all">‚úï Remove</button>` :
                            `<button onclick="addWeapon('${weapon.id}')" ${!canSelect ? 'disabled' : ''} class="w-full px-3 py-2 text-xs md:text-sm btn-primary rounded-lg font-bold">+ Add</button>`
                        }
                    </div>
                </div>
            `;
            
            return card;
        }

        // Add weapon to squad
        function addWeapon(weaponId) {
            if (gameState.squad.weapons.length >= 2) {
                alert('You can only select 2 weapons!');
                return;
            }
            
            const weapon = weapons.find(w => w.id === weaponId);
            
            if (gameState.budget < weapon.price) {
                alert('Not enough gold!');
                return;
            }
            
            gameState.squad.weapons.push({...weapon, paidPrice: weapon.price});
            gameState.budget -= weapon.price;
            
            saveGameState();
            updateDisplay();
            initWeaponsView();
        }

        // Remove weapon from squad
        function removeWeapon(weaponId) {
            const weapon = gameState.squad.weapons.find(w => w.id === weaponId);
            if (!weapon) return;
            
            gameState.budget += weapon.paidPrice;
            gameState.squad.weapons = gameState.squad.weapons.filter(w => w.id !== weaponId);
            
            saveGameState();
            updateDisplay();
            initWeaponsView();
        }

        // Update displays
        function updateDisplay() {
            document.getElementById('budget').textContent = gameState.budget;
            document.getElementById('weapon-count').textContent = gameState.squad.weapons.length;
        }

        // Navigation
        function goToSquad() {
            gameState.currentView = 'forge';
            saveGameState();
            window.location.href = 'forge-alliance.html';
        }

        // Add beforeunload to save state before leaving
        window.addEventListener('beforeunload', function() {
            saveGameState();
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            initWeaponsView();
        });
    </script>
</body>

</html>
